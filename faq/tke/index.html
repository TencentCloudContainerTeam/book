<!doctype html><html lang=zh class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.65.3"><meta name=description content="腾讯云容器服务"><meta name=author content="腾讯云容器架构师团队"><link rel=icon href=/images/favicon.png type=image/png><title>TKE 常见问题</title><script>window.algoliaAppID='B6Q6PSGUV5';window.algoliaKey='5b4678e9995fe4211c4fa43ad2ffdab5';window.algoliaIndex='kubetencent-book-zh';</script><script src=https://kubetencent-1251707795.cos.accelerate.myqcloud.com/js/bundle.min.8d534562810f42a5942ec72a0b7ae599c8bf0c96a4c8d6fafffa9bf21fce9d77.js></script><link rel=stylesheet href=https://kubetencent-1251707795.cos.accelerate.myqcloud.com/css/bundle.min.b0e6163350b1169d986890f4bd317db6286105863b7a53274abdb5c8d935eaa1.css><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style></head><body data-url=/faq/tke/><nav id=sidebar class=showVisitedLinks><div id=header-wrapper><div id=header><a id=logo href=https://book.kubetencent.io style=display:block><div style=width:100%;height:100%><img src=https://res.cloudinary.com/imroc/image/upload/c_scale,w_64/v1583293443/kubernetes-practice-guide/img/kubernetes.png><div style=height:100%;margin-bottom:3px;font-weight:700>腾讯云容器服务指南</div></div></a></div><div class=aa-input-container id=aa-input-container><input type=search id=aa-search-input class=aa-input-search placeholder=搜索... name=search autocomplete=off><svg class="aa-input-icon" viewBox="654 -372 1664 1664"><path d="M1806 332c0-123.3-43.8-228.8-131.5-316.5C1586.8-72.2 1481.3-116 1358-116s-228.8 43.8-316.5 131.5S910 208.7 910 332s43.8 228.8 131.5 316.5S1234.7 780 1358 780s228.8-43.8 316.5-131.5S1806 455.3 1806 332zm512 832c0 34.7-12.7 64.7-38 90s-55.3 38-90 38c-36 0-66-12.7-90-38l-343-342c-119.3 82.7-252.3 124-399 124-95.3.0-186.5-18.5-273.5-55.5s-162-87-225-150-113-138-150-225S654 427.3 654 332s18.5-186.5 55.5-273.5 87-162 150-225 138-113 225-150S1262.7-372 1358-372s186.5 18.5 273.5 55.5 162 87 225 150 113 138 150 225S2062 236.7 2062 332c0 146.7-41.3 279.7-124 399l343 343C2305.7 1098.7 2318 1128.7 2318 1164z" /></svg></div><script type=text/javascript>var baseurl="https:\/\/book.kubetencent.io";</script></div><div class=highlightable><ul class=topics><li data-nav-id=/intro/ title=产品指引 class=dd-item><a href=/intro/>产品指引
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/intro/tke/ title=TKE class=dd-item><a href=/intro/tke/>TKE
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/intro/eks/ title=EKS class=dd-item><a href=/intro/eks/>EKS
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/intro/tke-mesh/ title="TKE Mesh" class=dd-item><a href=/intro/tke-mesh/>TKE Mesh
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/intro/tcr/ title=TCR class=dd-item><a href=/intro/tcr/>TCR
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/intro/changelog/ title=更新历史 class=dd-item><a href=/intro/changelog/>更新历史
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/network/ title=集群网络 class=dd-item><a href=/network/>集群网络
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/network/understand-cluster-networking/ title=彻底理解集群网络 class=dd-item><a href=/network/understand-cluster-networking/>彻底理解集群网络
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/network/tke-networking/ title="TKE 集群网络介绍" class=dd-item><a href=/network/tke-networking/>TKE 集群网络介绍
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/network/analysis-cidr/ title="网络划分与最大节点/service/pod 的数量" class=dd-item><a href=/network/analysis-cidr/>网络划分与最大节点/service/pod 的数量
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/network/container-route/ title=容器路由互通 class=dd-item><a href=/network/container-route/>容器路由互通
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/ingress/ title=Ingress class=dd-item><a href=/ingress/>Ingress
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/ingress/understand-ingress/ title="彻底理解 Ingress" class=dd-item><a href=/ingress/understand-ingress/>彻底理解 Ingress
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/ingress/choose-ingress/ title="Ingress 方案选型" class=dd-item><a href=/ingress/choose-ingress/>Ingress 方案选型
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/ingress/tke-ingress/ title="TKE Ingress" class=dd-item><a href=/ingress/tke-ingress/>TKE Ingress
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/ingress/other/ title="开源 Ingress 方案" class=dd-item><a href=/ingress/other/>开源 Ingress 方案
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/ingress/other/nginx-ingress/ title="Nginx Ingress on TKE" class=dd-item><a href=/ingress/other/nginx-ingress/>Nginx Ingress on TKE
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/ingress/other/traefik-ingress/ title="Traefik Ingress on TKE" class=dd-item><a href=/ingress/other/traefik-ingress/>Traefik Ingress on TKE
<i class="fas fa-check read-icon"></i></a></li></ul></li></ul></li><li data-nav-id=/storage/ title=存储 class=dd-item><a href=/storage/>存储
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/andon/ title=附加组件 class=dd-item><a href=/andon/>附加组件
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/andon/install-metrics-server-on-tke/ title="在 TKE 中安装 metrics-server" class=dd-item><a href=/andon/install-metrics-server-on-tke/>在 TKE 中安装 metrics-server
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/monitoring/ title=监控告警 class=dd-item><a href=/monitoring/>监控告警
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/monitoring/deploy-prometheus-on-tke/ title="在 TKE 上搭建 Prometheus 监控系统" class=dd-item><a href=/monitoring/deploy-prometheus-on-tke/>在 TKE 上搭建 Prometheus 监控系统
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/log/ title=日志搜集 class=dd-item><a href=/log/>日志搜集
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/cicd/ title=CI/CD class=dd-item><a href=/cicd/>CI/CD
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/bigdata-ai/ title="大数据与 AI" class=dd-item><a href=/bigdata-ai/>大数据与 AI
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/bigdata-ai/gpu-share/ title="GPU 虚拟化" class=dd-item><a href=/bigdata-ai/gpu-share/>GPU 虚拟化
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/bigdata-ai/flink/ title=Flink class=dd-item><a href=/bigdata-ai/flink/>Flink
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/bigdata-ai/flink/intro/ title="Flink 介绍" class=dd-item><a href=/bigdata-ai/flink/intro/>Flink 介绍
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/bigdata-ai/flink/session-cluster/ title="Session Cluster 模式部署" class=dd-item><a href=/bigdata-ai/flink/session-cluster/>Session Cluster 模式部署
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/bigdata-ai/flink/job-cluster/ title="Job Cluster 模式部署" class=dd-item><a href=/bigdata-ai/flink/job-cluster/>Job Cluster 模式部署
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/bigdata-ai/flink/native-kubernetes/ title="Native Kubernetes 模式部署" class=dd-item><a href=/bigdata-ai/flink/native-kubernetes/>Native Kubernetes 模式部署
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/bigdata-ai/flink/ title="Flink on TKE/EKS" class=dd-item><a href=/bigdata-ai/flink/>Flink on TKE/EKS
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/bigdata-ai/spark/ title="Spark on TKE/EKS" class=dd-item><a href=/bigdata-ai/spark/>Spark on TKE/EKS
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/bigdata-ai/tensorflow/ title="TensorFlow on TKE/EKS" class=dd-item><a href=/bigdata-ai/tensorflow/>TensorFlow on TKE/EKS
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/faq/ title=FAQ class="dd-item
parent"><a href=/faq/>FAQ
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/faq/eks/ title="EKS 常见问题" class=dd-item><a href=/faq/eks/>EKS 常见问题
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/faq/tke/ title="TKE 常见问题" class="dd-item active"><a href=/faq/tke/>TKE 常见问题
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/faq/registry/ title=镜像仓库常见问题 class=dd-item><a href=/faq/registry/>镜像仓库常见问题
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/serverless/ title=Serverless class=dd-item><a href=/serverless/>Serverless
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/mesh/ title="Servie Mesh" class=dd-item><a href=/mesh/>Servie Mesh
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/containerization/ title=业务容器化 class=dd-item><a href=/containerization/>业务容器化
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/containerization/source-ip/ title="获取源 IP" class=dd-item><a href=/containerization/source-ip/>获取源 IP
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/containerization/fixed-ip/ title="固定 IP" class=dd-item><a href=/containerization/fixed-ip/>固定 IP
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/containerization/srpingcloud/ title="Spring Cloud" class=dd-item><a href=/containerization/srpingcloud/>Spring Cloud
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/containerization/dubbo/ title=Dubbo class=dd-item><a href=/containerization/dubbo/>Dubbo
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/security/ title=安全管控 class=dd-item><a href=/security/>安全管控
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/security/audit/ title=审计管理 class=dd-item><a href=/security/audit/>审计管理
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/security/app/ title=应用权限管理 class=dd-item><a href=/security/app/>应用权限管理
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/security/user/ title=用户权限管理 class=dd-item><a href=/security/user/>用户权限管理
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/damn/ title=避坑指南 class=dd-item><a href=/damn/>避坑指南
<i class="fas fa-check read-icon"></i></a></li></ul><section id=prefooter><hr><ul><li><a class=padding><i class="fas fa-language fa-fw"></i><div class=select-style><select id=select-language onchange="location=this.value;">
<option id=zh value=https://book.kubetencent.io/faq/tke/ selected>简体中文</option></select><svg id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="255" height="255" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255"><g><g id="arrow-drop-down"><polygon points="0,63.75 127.5,191.25 255,63.75" /></g></g></svg></div></a></li><li><a class=padding href=# data-clear-history-toggle><i class="fas fa-history fa-fw"></i>清理历史记录</a></li></ul></section><section id=footer><center><a class=github-button href=https://github.com/TencentCloudContainerTeam/book data-icon=octicon-star data-show-count=true aria-label="Star imroc/kubernetes-practice-guide on GitHub">Star</a>
<a class=github-button href=https://github.com/TencentCloudContainerTeam/book/fork data-icon=octicon-repo-forked data-show-count=true aria-label="Fork TencentCloudContainerTeam/book on GitHub">Fork</a></center>
<script async defer src=https://buttons.github.io/buttons.js></script></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=top-github-link><a class=github-link title=编辑当前页 href=https://github.com/TencentCloudContainerTeam/book/edit/master/content/zh/faq/tke.md target=blank><i class="fas fa-code-branch"></i><span id=top-github-link-text>编辑当前页</span></a></div><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i></a></span><span id=toc-menu><i class="fas fa-list-alt"></i></span><span class=links><a href=/>腾讯云容器服务指南</a> > <a href=/faq/>FAQ</a> > TKE 常见问题</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><ul><li><ul><li><ul><li><a href=#为什么挂载的-cfs-容量是-10g>为什么挂载的 CFS 容量是 10G</a></li><li><a href=#为什么-controller-manager-和-scheduler-状态显示-unhealthy>为什么 controller-manager 和 scheduler 状态显示 Unhealthy</a></li><li><a href=#为什么-kubectl-top-nodes-不行>为什么 kubectl top nodes 不行</a></li><li><a href=#我从-tke-集群所在-vpc-之外有办法能直接访问容器-ip-吗>我从 TKE 集群所在 VPC 之外有办法能直接访问容器 IP 吗</a></li><li><a href=#tke中的容器和idc自建k8s中的容器网络可以互通么>TKE中的容器和IDC自建k8s中的容器网络可以互通么？</a></li><li><a href=#idc-集群是否可以纳管云上的cvm-么>IDC 集群是否可以纳管云上的cvm 么？</a></li><li><a href=#在tke-pod-中为什么无法访问到公网>在TKE Pod 中为什么无法访问到公网？</a></li><li><a href=#cfs挂载在pod下的时候root权限我的pod启动是普通用户没法写入cfs怎么解决你们有什么方案吗>cfs挂载在pod下的时候root权限，我的pod启动是普通用户，没法写入cfs，怎么解决，你们有什么方案吗?</a></li></ul></li></ul></li></ul></li></ul></nav></div></div></div></div><div id=head-tags></div><div id=body-inner><h1>TKE 常见问题</h1><h5 id=为什么挂载的-cfs-容量是-10g>为什么挂载的 CFS 容量是 10G</h5><p>创建负载的时候可以挂载 NFS，如果使用 CFS 提供的 NFS 服务，当 NFS 被挂载好去查看实际容量时发现是 10G。</p><p>原因是: nfs的盘，默认的挂载大小为10G，支持自动扩容</p><p>cfs 扩容方式: 小于1T，容量到50%触发自动扩容，每次加100G; 大于 1T,到80%触发自动扩容。每次加500G</p><p>cfs 收费方式: 计费是根据实际的使用量，小于10G不收费，多于10G开始收费</p><h5 id=为什么-controller-manager-和-scheduler-状态显示-unhealthy>为什么 controller-manager 和 scheduler 状态显示 Unhealthy</h5><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>kubectl get cs
NAME                 STATUS      MESSAGE                                                                                        ERROR
scheduler            Unhealthy   Get http://127.0.0.1:10251/healthz: dial tcp 127.0.0.1:10251: getsockopt: connection refused
controller-manager   Unhealthy   Get http://127.0.0.1:10252/healthz: dial tcp 127.0.0.1:10252: getsockopt: connection refused
etcd-0               Healthy     <span style=color:#f92672>{</span><span style=color:#e6db74>&#34;health&#34;</span>: <span style=color:#e6db74>&#34;true&#34;</span><span style=color:#f92672>}</span>
</code></pre></div><p>查看组件状态发现 controller-manager 和 scheduler 状态显示 Unhealthy，但是集群正常工作，是因为TKE metacluster托管方式集群的 apiserver 与 controller-manager 和 scheduler 不在同一个节点导致的，这个不影响功能。如果发现是 Healthy 说明 apiserver 跟它们部署在同一个节点，所以这个取决于部署方式。</p><p><strong>更详细的原因：</strong></p><p>apiserver探测controller-manager 和 scheduler写死直接连的本机</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>s</span> <span style=color:#a6e22e>componentStatusStorage</span>) <span style=color:#a6e22e>serversToValidate</span>() <span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#f92672>*</span><span style=color:#a6e22e>componentstatus</span>.<span style=color:#a6e22e>Server</span> {
	<span style=color:#a6e22e>serversToValidate</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#f92672>*</span><span style=color:#a6e22e>componentstatus</span>.<span style=color:#a6e22e>Server</span>{
		<span style=color:#e6db74>&#34;controller-manager&#34;</span>: {<span style=color:#a6e22e>Addr</span>: <span style=color:#e6db74>&#34;127.0.0.1&#34;</span>, <span style=color:#a6e22e>Port</span>: <span style=color:#a6e22e>ports</span>.<span style=color:#a6e22e>InsecureKubeControllerManagerPort</span>, <span style=color:#a6e22e>Path</span>: <span style=color:#e6db74>&#34;/healthz&#34;</span>},
		<span style=color:#e6db74>&#34;scheduler&#34;</span>:          {<span style=color:#a6e22e>Addr</span>: <span style=color:#e6db74>&#34;127.0.0.1&#34;</span>, <span style=color:#a6e22e>Port</span>: <span style=color:#a6e22e>ports</span>.<span style=color:#a6e22e>InsecureSchedulerPort</span>, <span style=color:#a6e22e>Path</span>: <span style=color:#e6db74>&#34;/healthz&#34;</span>},
	}
</code></pre></div><p>源码：https://github.com/kubernetes/kubernetes/blob/v1.14.3/pkg/registry/core/rest/storage_core.go#L256</p><p>相关 issue:</p><ul><li><a href=https://github.com/kubernetes/kubernetes/issues/19570>https://github.com/kubernetes/kubernetes/issues/19570</a></li><li><a href=https://github.com/kubernetes/enhancements/issues/553>https://github.com/kubernetes/enhancements/issues/553</a></li></ul><h5 id=为什么-kubectl-top-nodes-不行>为什么 kubectl top nodes 不行</h5><p>执行 <code>kubectl top nodes</code> 报 NotFound:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ kubectl top nodes
Error from server <span style=color:#f92672>(</span>NotFound<span style=color:#f92672>)</span>: the server could not find the requested resource
</code></pre></div><p>这是因为 metrics api 的 apiservice 指向的 TKE 自带的 hpa-metrics-server，而 hpa-metrics-server 不支持 node 相关的指标，hpa-metrics-server 主要用于 HPA 功能(Pod 横向自动伸缩)，伸缩判断指标最开始使用的 metrics api，后来改成了 custom metrics api。</p><p><code>kubectl top nodes</code> 是请求的 metrics api，由于 TKE 控制台的 HPA 功能不依赖 metrics api 了，可以自行修改其 apiservice 的指向为自建的 metrics server，比如最简单的官方开源的 <a href=https://github.com/kubernetes-sigs/metrics-server>metrics-server</a>，参考 <a href=../../andon/install-metrics-server-on-tke/>在 TKE 中安装 metrics-server</a>，或者如果你集群中使用 prometheus，可以安装 <a href=https://github.com/DirectXMan12/k8s-prometheus-adapter>k8s-prometheus-adapter</a> 来适配 metrics api，也可以直接部署 <a href=https://github.com/coreos/kube-prometheus>kube-prometheus</a> 安装更全面的 prometheus on kubernetes 全家桶套件。</p><p>不管怎样，最后确保 <code>v1beta1.metrics.k8s.io</code> 这个 apiservice 指向了你自己的 metrics api 适配服务，通过 <code>kubectl -n kube-system edit apiservice v1beta1.metrics.k8s.io</code> 可以修改。</p><h5 id=我从-tke-集群所在-vpc-之外有办法能直接访问容器-ip-吗>我从 TKE 集群所在 VPC 之外有办法能直接访问容器 IP 吗</h5><p>如果你的网络已经通过专线、对等连接、云联网或 VPN 等方式跟 TKE 集群所在 VPC 做了打通，可以参考 <a href=../../network/container-route/>容器路由互通</a> 来进一步打通容器路由。</p><h5 id=tke中的容器和idc自建k8s中的容器网络可以互通么>TKE中的容器和IDC自建k8s中的容器网络可以互通么？</h5><p>这个问题分两种情况，分别说明：
（1） IDC k8s 中的容器访问TKE 中的容器。
完全可以，tke 的容器网络默认是基于全局路由的模式，IDC 和 腾讯云拉通专线（或者接入云联网）后，只要将TKE 集群的容器路由下发到IDC 的网关，就可以实现访问。</p><p>（2） TKE 的容器访问IDC k8s 中的容器。
不一定：要看自建k8s 集群使用的网络模式，能否把容器路由发布到腾讯云的网关。
如果自建k8s 使用使用3层路由（如calico 的bgp模式），或者大二层（如macvlan）的模式网络模式，则可以将容器路由发布到云上，实现访问。
如果自建k8s 使用隧道网络模式（如flannel 或者calico 的ipip 模式），无法将路由发布出来，则无法访问。</p><h5 id=idc-集群是否可以纳管云上的cvm-么>IDC 集群是否可以纳管云上的cvm 么？</h5><p>理论上可行，但不建议这么做，建议使用多集群方案，主要有以下几个原因：</p><ol><li>IDC和云上cvm 依赖专线或者云联网互通，网络抖动和延迟都会对集群管理带来影响。</li><li>IDC的网络环境和云上不一样，需要根据实际情况选择合适的网络插件，导致IDC 和 云上的网络插件不一致，使容器网络的管理复杂度增高：</li><li>目前还没有这样的客户案例，未经过生产验证，风险较高。</li><li>通过多集群来避免但集群故障，使用原生fedration 或者 一些开源工具（如rancher）来管理多集群也很方便。</li></ol><h5 id=在tke-pod-中为什么无法访问到公网>在TKE Pod 中为什么无法访问到公网？</h5><p>在TKE 中，podip 首先snat 成nodeip, 然后通过nodeip 出公网。
podip snat 成nodeip 是通过k8s 组件 ip-masq-agent 修改iptables 规则来实现的。
TKE 默认 ip-masq-agent-config 配置在vpc 内不做snat, vpc 之外都做snat.</p><p>所以如果pod 无法访问公网，需要分两种情况检查以下配置：</p><ol><li>如果node可以访问公网；
检查ip-masq-agent-config 配置，podip 出公网时是否做了snat 。</li><li>如果node 不可以访问公网</li></ol><ol><li>检查/etc/resolv.conf ，看nameserver 配置是否正确，腾讯云主机默认nameserver如下：
nameserver 183.60.83.19
nameserver 183.60.82.98</li><li>如果域名解析没有问题，那就应该是公网ip 或者nat网关的问题，联系相关同事排查。</li></ol><h5 id=cfs挂载在pod下的时候root权限我的pod启动是普通用户没法写入cfs怎么解决你们有什么方案吗>cfs挂载在pod下的时候root权限，我的pod启动是普通用户，没法写入cfs，怎么解决，你们有什么方案吗?</h5><p><a href=https://cloud.tencent.com/document/product/582/10951>https://cloud.tencent.com/document/product/582/10951</a></p><p>如cfs 文档所示，默认情况下文件系统的权限是755， 只有root 用户有写权限。
如果非root 用户要写，那么有两种情况：</p><ol><li>非root 用户在root 组，要求文件系统的权限为 775 (rwxrwxr-x)</li><li>非root 用户不在root 组，要求文件系统权限为 777 (rwxrwxrwx)
总之用户要有对应的写权限。</li></ol><p>具体如何改文件系统权限，可以咨询下cfs 的同事。
一种做法是：将nfs 挂载到本地，通过chmod 来改。</p><footer class=footline></footer></div><div id=gitalk-container></div><link rel=stylesheet href=https://unpkg.com/gitalk/dist/gitalk.css><script src=https://unpkg.com/gitalk/dist/gitalk.min.js></script><script>console.log("gitalk id:5b8c8628af06b726e8ebe82b2bfeab9c")
var gitalk=new Gitalk({clientID:'4e9444088ec088b58f37',clientSecret:'b8faa4be9753a13d0b01ccdf4ccc015f9983b58c',repo:'book',owner:'TencentCloudContainerTeam',admin:["imroc","coderwangke","willbern"],labels:['Gitalk'],title:'TKE 常见问题',createIssueManually:false,id:'5b8c8628af06b726e8ebe82b2bfeab9c',distractionFreeMode:true});gitalk.render('gitalk-container');</script></div><div id=navigation><a class="nav nav-prev" href=/faq/eks/ title="EKS 常见问题"><i class="fa fa-chevron-left"></i></a><a class="nav nav-next" href=/faq/registry/ title=镜像仓库常见问题 style=margin-right:0><i class="fa fa-chevron-right"></i></a></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div></body></html>