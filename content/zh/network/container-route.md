---
title: "容器路由互通"
weight: 40
state: "Alpha"
---

## 概述

TKE 的 POD IP 默认在整个 VPC 可路由，要在 VPC 之外访问 POD IP 可能就需要下发路由(打通)才能访问，下面罗列容器路由互通的各种情况与容器路由打通方法。

## 云联网容器路由互通

如果需要容器路由互通的是两个不同 VPC，并且都支持[云联网](https://cloud.tencent.com/product/ccn)，那么可以直接将你的集群开启云联网，容器路由就可以自动注册上去，跨 VPC 的容器路由就可以互通了。

集群启用云联网方法：在集群信息页点击这里开启云联网

![](/images/cnn.png?classes=no-margin)

## 对等连接打通的 VPC 之间容器路由互通

* 如果两个 VPC 是同地域的，可以自行配置 VPC 路由表，在容器的对端 VPC (要访问容器 IP VPC) 的 VPC 路由表下一跳增加容器网段下一跳，指向对应的对等连接网关即可。
* 如果两个 VPC 是不同地域的，除了跟上面同地域容器互通操作之外，还需要提工单或找联系售后来做路由打通操作（实际就是下发容器路由给对等连接网关）。若有已创建的 TKE 集群，请提供集群id与对等连接id(pcx-开头)，否则提供：对等连接id、容器所在地域、vpcid (vpc-开头) 与容器网段。

## 专线打通的网络之间容器路由互通

如果您的 IDC 或办公网通过专线与腾讯云 VPC 打通，并且想要跟腾讯云 VPC 里的 TKE 容器路由互通，需要提工单或找联系售后来做路由打通操作（实际就是下发容器路由给专线网关）。

若有已创建的 TKE 集群，请提供集群id与专线网关id(pcg-开头)，否则提供对等连接id、容器所在地域、vpcid (vpc-开头) 、容器网段与专线网关id。如果您的 IDC 或办公网的网络是 BGP 的，可以自动学习容器路由，待容器路由打通之后，即可正常访问容器 IP，如果不是 BGP 则需要配置路由，容器网段下一跳到专线网关。

## 注意

路由打通之后，可以修改下集群中 ip-masq-agent 的配置来优化下:

``` bash
kubectl -n kube-system edit configmap ip-masq-agent-config
```

`nonMasqueradeCIDRs` 加上容器对端网络的网段，这样可以让从容器里主动请求对端网络的 IP 不做 SNAT，因为路由已经通了，出 VPC 的包就可以不用 SNAT，减少性能损耗。
